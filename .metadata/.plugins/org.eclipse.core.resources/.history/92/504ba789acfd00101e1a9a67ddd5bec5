package com.revplay.service;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.revplay.dao.UserDao;
import com.revplay.model.User;

public class UserService {

	private static final Logger logger = LoggerFactory
			.getLogger(UserService.class);

	private UserDao userDao;

	public UserService(UserDao userDao) {
		this.userDao = userDao;
	}

	public boolean register(String username, String email, String password,
			String role) {

		logger.info("Registration attempt for username: {}, email: {}",
				username, email);

		try {
			User user = new User();
			user.setUsername(username);
			user.setEmail(email);
			user.setPassword(password);
			user.setRole(role.trim().toUpperCase());

			boolean result = userDao.registerUser(user);

			if (result)
				logger.info("User registered successfully: {}", username);
			else
				logger.warn("Registration failed for user: {}", username);

			return result;

		} catch (Exception e) {
			logger.error("Error during registration for user: {}", username, e);
			return false;
		}
	}

	public void login(String username, String password) {

		User user = userDao.verifyUser(username, password);

		if (user == null) {
			System.out.println("Wrong credentials!");
			return;
		}

		if (user.getPassword().equals(password)) {
			System.out.println("Login successful");
		} else {
			System.out.println("Wrong credentials!");
		}
	}

	// logger.info("Login attempt for input: {}", input);
	// logger.error("Login error for input: {}", input, e);
	public boolean verifyUser(String email, String username) {

		logger.info("Verifying user: {} with email: {}", username, email);

		try {
			boolean exists = userDao.verifyUser(email, username);

			if (!exists)
				logger.warn("User verification failed: {}", username);

			return exists;

		} catch (Exception e) {
			logger.error("Error verifying user: {}", username, e);
			return false;
		}
	}

	public boolean resetPassword(String email, String newPassword) {

		logger.info("Password reset attempt for email: {}", email);

		try {
			boolean updated = userDao.updatePassword(email, newPassword);

			if (updated)
				logger.info("Password reset successful for email: {}", email);
			else
				logger.warn("Password reset failed for email: {}", email);

			return updated;

		} catch (Exception e) {
			logger.error("Error resetting password for email: {}", email, e);
			return false;
		}
	}
}
